# TODO — 2025-10-22

## Critical Security
- ✅ Add CSRF token generation/verification middleware for POST/PUT/PATCH/DELETE routes; document expected headers for the frontend.
- ✅ Introduce route-level authorisation guard that validates `x-ffm-actor`/`x-ffm-team` against session context before hitting services.
- Harden environment validation: fail boot when `VITE_USE_API=true` but `VITE_TEAM_ID` or API base URL is missing.

## Core Functionality
- ✅ SeasonStatsView now pushes team context through API fetches and warns when `VITE_TEAM_ID` is missing.
- ✅ Pick a Team flow: post-lock edits refresh backend stats and audit fetches run under team scope, covered by new API-mode integration test.
- ✅ Roster tooling mirrors API-mode team scoping with UI fallback messaging and tests.
- Season snapshot audit fallback: replace synthetic player names once backend audit schema surfaces richer identity data.

## Testing & Tooling
- ✅ Extend Vitest coverage for audit API handler (`api/audit/index.ts`) to assert error paths (missing teamId, invalid limit).
- ✅ Add contract tests around `/api/fixtures` to confirm team scoping and prevent regressions during refactors.

## Documentation
- Draft `docs/security.md` outlining CSRF/auth middleware design and header requirements.
- Update README “API Mode” section with new team ID requirement and troubleshooting steps for audit fetch failures.

## Deployment
- Verify Vercel env vars include `VITE_TEAM_ID`, `VITE_USE_API`, and the forthcoming CSRF secret.
- Add checklist item to CI/CD to run `npm test -- --run --pool=threads` prior to deploy.
